## Spring Bean Post Processor

`Spring` 을 사용할 경우 의존성을 추가하게 되면 `Spring`이 가지고 있는 **빈 후처리기** 를 통해서 동작한다.

#### 자동 프록시 생성기 - AutoProxyCreator

`Spring Boot`는 자동 설정으로 `AnnotationAwareAspectJAutoProxyCreator` 라는 **빈 후처리기**가 `Spring bean` 으로 등록된다.

자동으로 **프록시**를 생성해주는 **빈 후처리기**이며, `Spring Bean` 으로 등록된 `Advisor`들을 찾아서

**프록시**가 필요한 곳에 자동으로 프록시를 적용해준다.

이 때, `Advisor`는 `Pointcut` 과 `Advice` 를 가지고 있어 `Spring Bean` 으로 등록된 `Advisor` 가 가진

`Pointcut` 을 보고 판단하여 해당 `Advisor` 를 **프록시**로 적용해야 할 지 말지를 판단한다.



--- 

#### 자동 프록시 생성기의 동작과정
1. **생성** : `Spring`이 `Spring Bean` 대상이 되는 객체를 생성한다.
2. **전달** : 생성된 객체를 빈 저장소에 등록하기 직전에 **빈 후처리기**에 전달한다
3. **모든 Advisor 빈 조회** : **빈 후처리기**는 스프링 컨테이너의 모든 `Advisor`를 조회한다.
4. **프록시 적용 대상 체크** : 앞서 조회한 `Advisor` 에 포함되어 있는 `Pointcut`을 사용해서 
 해당객체가 **프록시**를 적용할 대상인지 아닌지 판단한다. 객체의 클래스 정보, 모든 메서드를 **포인트컷**에 하나하나 매칭하고 맞으면 **프록시 적용대상**이 된다. 
5. **프록시 생성** : **프록시 적용 대상이면 프록시를 생성**하고 반환해서 **프록시를 스프링 빈으로 등록**한다. 
아니라면 그대로 반환한다.
6. **빈 등록**: 반환된 객체가 스프링 빈으로 등록된다.


> 따라서, 개발자는 `Advisor` 객체를 `Spring Bean` 으로 등록만 하면 자동으로 **프록시**를 생성해준다.


---

### Pointcut 사용 위치

`Pointcut` 은 2가지에 사용된다.
1. **프록시 적용 여부 판단 - 생성 단계**
- 자동 프록시 생성기는 `Pointcut` 을 사용해서 `Bean` 이 프록시를 생성할 필요가 있는지 체크한다.
- 이 때, `Class` + `Method` 를 모두 비교하는데, 조건이 맞으면 프록시를 생성하고 아니라면 생성하지 않는다.

2. **Advice 적용 여부 판단 - 사용 단계**
- 프록시가 호출되었을 때 `Advice` 를 적용할 지 말지 `Pointcut`을 보고 판단한다.



----
### 하나의 프록시, 여러개의 Advisor 적용

자동 프록시 생성기는 프록시를 하나만 생성한다.

내부적으로 `ProxyFactory` 를 이용하는데 내부에 여러 개의 `Advisor` 를 적용할 수 있기 때문에 여러개를 생성할 필요가 없다.





