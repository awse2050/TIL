## BeanPostProcessor ( 빈 후처리기 )

`Spring` 이 `Bean` 저장소에 등록할 목적으로 생성한 객체를 `Bean` 저장소에 등록하기 전에 조작하고 싶다면

**빈 후처리기** 를 사용하면 된다.

이름 그대로 `Bean` 을 생성한 후에 무언가를 처리하는 용도로 쓰인다.

이떄, **객체를 조작**할 수 도 있고, 아예 **다른 객체로 바꿔치기** 할 수 도 있다.


### 빈 등록과정 및 빈 후처리기

1. **생성** : `Spring Bean` 대상이 되는 객체를 생성한다.

2. **전달** : 생성된 객체를 `Bean` 저장소에 등록하기 전에 **빈 후처리기**에 전달한다.

3. **후 처리 작업** : **빈 후처리기**는 전달된 스프링 빈 객체를 조작하거나 다른 객체로 바꿔치기 할 수 있다.
 
4. **등록** : **빈 후처리기**는 빈을 반환한다. 전달된 빈을 그대로 반환하면 해당 빈이 등록되고 바꿔치기 하면 다른 객체가 빈 저장소에 등록된다.


### BeanPostProcessor Interface
```java
public interface BeanPostProcessor {
 Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException
 Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException
}

```

빈 후처리기를 사용하려면 `BeanPostProcessor` 인터페이스를 구현하고, `Spring Bean` 으로 등록하면 된다.

- `postProcessBeforeInitializtion` : 객체 생성 이후 `@PostConstruct` 같은 초기화가 발생하기 전에 호출되는 포스트 프로세서이다.

- `postProcessAfterInitialization` : 객체 생성 이후 `@PostConstruct` 같은 초기화가 발생한 다음에 호출되는 포스트 프로세서이다.


#### 정리

**빈 후처리기**는 `Bean` 을 조작하고 변경할 수 있는 **후킹 포인트**이다.

빈 객체를 조작하거나 심지어 다른 객체로 바꿔버릴 수 도 있다.

여기서 **조작**은 **해당 객체의 특정 메서드를 호출하는 것**을 뜻한다.

특히, **컴포넌트 스캔**의 대상이 되는 빈들은 중간에 조작할 방법이 없는데,

**빈 후처리기**를 사용하면 개발자가 등록하는 모든 빈을 중간에 조작할 수 있다.

**이 말은, 빈 객체를 프록시 객체로 교체하는 것도 가능하다는 뜻이다.**


그 예시로, `@PostConstruct` 가 있는데, 이것은 해당 어노테이션이 붙은 초기화 메서드를 한 번 실행하는 것이다.

쉽게 말해 생성된 빈을 한번 조작하는 것이다.


### 문제 해결

**빈 후처리기**덕분에 **프록시**를 생성하는 부분을 하나로 집중할 수 있다.

그리고 컴포넌트 스캔처럼 스프링이 직접 대상을 빈으로 등록하는 경우에도 중간에 빈 등록 과정을 가로채서 원본 대신 **프록시**를 스프링 빈으로 등록할 수 있다.

덕분에 애플리케이션에 많은 빈이 추가되어도 프록시와 관련된 코드는 변경하지 않아도된다.

**스프링은 프록시를 생성하기 위한 빈 후처리기를 이미 만들어서 제공한다.**

### 중요

프록시의 적용 대상여부를 여기서는 간단히 패키지 기준으로 설정했다.

그런데 잘 생각해보면 **포인트컷**을 사용하면 더 깔끔할 것 같다.

**포인트컷**은 이미 클래스, 메서드 단위의 필터기능을 가지고 있으므로 프록시의 적용대상 여부를 정밀하게 설정할 수 있다.

참고로 **어드바이저**는 **포인트컷**을 가지고 있다. 따라서 **어드바이저**를 통해 **포인트컷**을 확인할 수 있다.

뒤에서 학습하겠지만, **스프링 AOP**는 **포인트컷**을 사용해서 **프록시 적용대상 여부를 체크**한다.

결과적으로 **포인트컷**은 두곳에서 사용된다,.

1) 프록시 적용 대상 여부를 체크해서 필요한 곳에만 프록시를 적용한다. (빈 후처리기 - 자동 프록시 생성)

2) 프록시의 어떤 메서드가 호출되었을 때 어드바이스를 적용할 지 판단한다.  (프록시 내부)
